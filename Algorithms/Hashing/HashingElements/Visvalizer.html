<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Division Hashing Visualization</title>
    <link rel="stylesheet" href="../hashing.css">
    <link rel="stylesheet" href="visualizer.css">
    <style>
        /* Add this to your existing styles */
        #message {
            font-size: 18px;
            margin-top: 20px;
            color: #FFD700; /* Yellow color for search results */
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h2>Hashing Algorithm</h2>
        <a href="../hashing.html">Home</a>
        <a href="aim.html">Aim</a>
        <a href="overview.html">Overview</a>
        <a href="recap.html">Recap</a>
        <a href="pretest.html">Pretest</a>
        <a href="hashingcode.html" >Hashing Algorithm</a>
        <a href="code-assessment.html" class="active">Code Assessment</a>
        <a href="analysis.html">Analysis</a>
        <a href="posttest.html">Posttest</a>
        <a href="references.html">Further Readings/References</a>
        <a href="feedback.html">Feedback</a>
    </div>
    <div class="content">
        <h1>Prime Division Hashing Visualization</h1>
        <div class="description">
            <h2>What is Prime Division Hashing?</h2>
            <p>Prime Division Hashing is a method used to store and retrieve data in a hash table. It uses a prime number as the table size and calculates the index by taking the remainder of the value divided by the prime number. This visualization demonstrates how values are stored, how collisions are handled using linear probing, and how to search for values in the hash table.</p>
        </div>
        <div id="controls">
            <input type="number" id="primeInput" placeholder="Enter a prime number">
            <button onclick="setPrime()">Set Table Size</button>
            <input type="number" id="valueInput" placeholder="Enter a number to store">
            <button onclick="addValue()">Store Number</button>
            <button onclick="resetTable()">Clear Table</button>
            <input type="number" id="searchInput" placeholder="Enter a number to search">
            <button onclick="searchValue()">Search Number</button>
        </div>
        <div id="calculation"></div>
        <div id="hashTable"></div>
        <div id="message"></div>
        <div class="next-button" >
            <a href="analysis.html">Next</a>
        </div> 
    </div>

    <script>
        let tablePrime = 7;
        let hashTable = new Array(tablePrime).fill(null);

        function initializeHashTable() {
            const hashTableElement = document.getElementById('hashTable');
            hashTableElement.innerHTML = '';
            for (let i = 0; i < tablePrime; i++) {
                const bucket = document.createElement('div');
                bucket.className = 'bucket empty';
                bucket.id = `bucket-${i}`;
                bucket.innerHTML = `
                    <div class="bucket-index">Slot ${i}</div>
                    <div class="bucket-value">Empty</div>
                `;
                hashTableElement.appendChild(bucket);
            }
        }

        function hash(value) {
            return value % tablePrime;
        }

        function isPrime(num) {
            for (let i = 2, sqrt = Math.sqrt(num); i <= sqrt; i++) {
                if (num % i === 0) return false;
            }
            return num > 1;
        }

        function setPrime() {
            const primeInput = document.getElementById('primeInput');
            const newPrime = parseInt(primeInput.value);
            if (isPrime(newPrime)) {
                tablePrime = newPrime;
                hashTable = new Array(tablePrime).fill(null);
                initializeHashTable();
                showMessage(`Table size set to ${tablePrime}. This prime number helps distribute values evenly.`);
            } else {
                showMessage(`Please enter a prime number. ${newPrime} is not prime. Prime numbers help in better distribution.`);
            }
            primeInput.value = '';
        }

        async function addValue() {
            const input = document.getElementById('valueInput');
            const value = parseInt(input.value);
            if (isNaN(value)) {
                showMessage('Please enter a valid number to store in the hash table.');
                return;
            }

            let index = hash(value);
            showCalculation(value, index);
            await highlightBucket(index, 'highlight');
            
            if (hashTable[index] === null) {
                hashTable[index] = value;
                updateBucket(index, value);
                showMessage(`Number ${value} stored in slot ${index}`);
            } else {
                await linearProbe(index, value);
            }

            input.value = '';
        }

        async function linearProbe(startIndex, value) {
            let index = startIndex;
            for (let attempt = 0; attempt < tablePrime; attempt++) {
                await highlightBucket(index, 'collision');
                index = (index + 1) % tablePrime;
                showCalculation(value, index, true);
                await highlightBucket(index, 'highlight');
                
                if (hashTable[index] === null) {
                    hashTable[index] = value;
                    updateBucket(index, value);
                    showMessage(`Collision handled: ${value} stored in the next empty slot ${index}`);
                    return;
                }
            }
            showMessage(`Table is full. Cannot store ${value}. Try increasing the table size.`);
        }

        function updateBucket(index, value) {
            const bucket = document.getElementById(`bucket-${index}`);
            bucket.classList.remove('empty');
            bucket.querySelector('.bucket-value').textContent = value;
        }

        async function highlightBucket(index, className) {
            const bucket = document.getElementById(`bucket-${index}`);
            bucket.classList.add(className);
            await new Promise(resolve => setTimeout(resolve, 500));
            bucket.classList.remove(className);
        }

        function showMessage(msg) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = msg;
            messageElement.style.color = '#FFD700'; // Set text color to yellow
        }

        function showCalculation(value, index, isProbing = false) {
            const calculationElement = document.getElementById('calculation');
            let calculation = `Storing ${value} in our hash table:<br>`;
            calculation += `We divide ${value} by our table size ${tablePrime}.<br>`;
            calculation += `${value} รท ${tablePrime} = ${Math.floor(value / tablePrime)} with remainder ${index}<br>`;
            
            if (isProbing) {
                calculation += `That slot is occupied. Looking for the next empty slot...`;
            } else {
                calculation += `The remainder ${index} tells us to try storing ${value} in slot ${index}`;
            }
            
            calculationElement.innerHTML = calculation;
        }

        function resetTable() {
            hashTable = new Array(tablePrime).fill(null);
            initializeHashTable();
            showMessage('Hash table cleared. All slots are now empty.');
            document.getElementById('calculation').innerHTML = '';
        }

        // function searchValue() {
        //     const searchInput = document.getElementById('searchInput');
        //     const value = parseInt(searchInput.value);
        //     if (isNaN(value)) {
        //         showMessage('Please enter a valid number to search for.');
        //         return;
        //     }

        //     const index = hash(value);
        //     let found = false;

        //     if (hashTable[index] === value) {
        //         found = true;
        //         showMessage(`Number ${value} found in slot ${index}.`);
        //     } else {
        //         for (let attempt = 0; attempt < tablePrime; attempt++) {
        //             const probeIndex = (index + attempt) % tablePrime;
        //             if (hashTable[probeIndex] === value) {
        //                 found = true;
        //                 showMessage(`Number ${value} found in slot ${probeIndex} after probing.`);
        //                 break;
        //             }
        //         }
        //     }

        //     if (!found) {
        //         showMessage(`Number ${value} not found in the hash table.`);
        //     }

        //     searchInput.value = '';
        // }
        function searchValue() {
            const searchInput = document.getElementById('searchInput');
            const value = parseInt(searchInput.value);
            if (isNaN(value)) {
                showMessage('Please enter a valid number to search for.');
                return;
            }

            const index = hash(value);
            let found = false;

            if (hashTable[index] === value) {
                found = true;
                showMessage(`Number ${value} found in slot ${index}.`);
            } else {
                for (let attempt = 0; attempt < tablePrime; attempt++) {
                    const probeIndex = (index + attempt) % tablePrime;
                    if (hashTable[probeIndex] === value) {
                        found = true;
                        showMessage(`Number ${value} found in slot ${probeIndex} after probing.`);
                        break;
                    }
                }
            }

            if (!found) {
                showMessage(`Number ${value} not found in the hash table.`);
            }

            searchInput.value = '';
        }
        window.onload = initializeHashTable;
    </script>
     
</body>
</html>